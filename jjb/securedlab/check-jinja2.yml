########################
# Job configuration to validate jninja2 files
########################
- project:

    name: validate-templates

    project: 'securedlab'

    jobs:
        - 'validate-jinja2-templates-{stream}'

    stream:
        - master:
            branch: '{stream}'
            disabled: false
        - danube:
            branch: 'stable/{stream}'
            disabled: false

########################
# job templates
########################

- job-template:
    name: 'validate-jinja2-templates-{stream}'

    disabled: '{obj:disabled}'

    concurrent: true

    parameters:
        - project-parameter:
            project: $GERRIT_PROJECT
            branch: '{branch}'
        - node:
            name: SLAVE_NAME
            description: Slave to execute jnija template test
            default-slaves:
                - lf-build1
            allowed-multiselect: true
            ignore-offline-nodes: true

    scm:
        - git-scm-gerrit

    triggers:
        - gerrit-trigger-patchset-created-files:
            project: '{project}'
            branch: '{branch}'
            file-paths:
                - compare-type: ANT
                  pattern: 'utils/generate_config.yml'
                - compare-type: ANT
                  pattern: '**/*.jinja2'
                - compare-type: ANT
                  pattern: '**/*.yaml'

    builders:
        - check-jinja

- builder:
    name: check-jinja
    builders:
        - shell:
            !include-raw-escape: ./check-jinja2.sh
