########################
# Job configuration for joid
########################
- project:

    name: 'joid'

    installer: 'joid'

    controller: 'odl'

    pod: 'intel-pod5'

    stream:
        - master:
            branch: 'master'
            gs-pathname: ''

    jobs:
        - 'joid-{controller}-{pod}-daily-{stream}'
        - 'joid-deploy-{pod}-daily-{stream}'

########################
# job templates
########################
- job-template:
    name: 'joid-{controller}-{pod}-daily-{stream}'

    disabled: false

    concurrent: false

    parameters:
        - project-parameter:
            project: '{installer}'
        - 'intel-us-build-1-defaults'
        - '{installer}-defaults':
            controller: '{controller}'

    scm:
        - git-scm:
            credentials-id: '{ssh-credentials}'
            refspec: ''
            branch: '{branch}'

    builders:
        - trigger-builds:
          - project: 'joid-deploy-{pod}-daily-{stream}'
            git-revision: true
            block: true
            predefined-parameters:
                CONTROLLER={controller}

- job-template:
    name: 'joid-deploy-{pod}-daily-{stream}'

    disabled: false

    concurrent: false

    wrappers:
        - build-name:
            name: '$BUILD_NUMBER: {installer} $CONTROLLER'

    parameters:
        - project-parameter:
            project: '{installer}'
        - '{pod}-defaults'
        - '{installer}-defaults':
            controller: '{controller}'

    scm:
        - git-scm:
            credentials-id: '{ssh-credentials}'
            refspec: ''
            branch: '{branch}'

    builders:
        - '{pod}-builder'

########################
# builder macros
########################
- builder:
    name: intel-pod5-builder
    builders:
        - shell: |
            #!/bin/bash
            echo "Running $INSTALLER_NAME with controller $CONTROLLER"
            echo "Please note that this is a quick try to see how joid deployment works"
            echo
            echo "Executing clean.sh"
            cd $WORKSPACE/ci
            ./clean.sh
        - shell: |
            cd $WORKSPACE/ci
            echo "Executing 02-maasdeploy.sh intelpod5"
            ./02-maasdeploy.sh intelpod5
        - shell: |
            cd $WORKSPACE/ci
            echo "Executing deploy.sh -o liberty -s $CONTROLLER -t ha -l intelpod5"
            ./deploy.sh -o liberty -s $CONTROLLER -t ha -l intelpod5
