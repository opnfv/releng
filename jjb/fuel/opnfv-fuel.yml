########################
# Job configuration for fuel
########################
- project:

    name: 'opnfv-fuel'

    installer: 'fuel'

    controller:
        - 'odl'
        - 'onos'
        - 'opencontrail'

    pod:
        - 'opnfv-jump-2'
        - 'ericsson-pod1'

    loop:
        - 'daily'

    # ignore these as these will not exist in real job
    dummy-phase:
        - build
        - deploy
        - functest
        - yardstick

    stream:
        - master:
            branch: 'master'
            gs-pathname: ''

    jobs:
        - 'tmp_fuel-{controller}-{pod}-{loop}-{stream}'
        - 'tmp_fuel-{dummy-phase}-{pod}-{loop}-{stream}'

########################
# job templates
########################
- job-template:
    name: 'tmp_fuel-{controller}-{pod}-{loop}-{stream}'

    project-type: multijob

    parameters:
        - project-parameter:
            project: '{installer}'
        - 'ericsson-ca-build-1-defaults'
        - '{installer}-defaults'
        - string:
            name: CONTROLLER
            default: '{controller}'
        - string:
            name: FEATURE
            default: 'none'

    scm:
        - git-scm:
            credentials-id: '{ssh-credentials}'
            refspec: ''
            branch: '{branch}'

    builders:
        - multijob:
            name: build
            condition: SUCCESSFUL
            projects:
                - name: 'tmp_fuel-build-{loop}-{stream}'
                  kill-phase-on: FAILURE
                  current-parameters: true
        - multijob:
            name: deploy
            condition: SUCCESSFUL
            projects:
                - name: 'tmp_fuel-deploy-{pod}-{loop}-{stream}'
                  kill-phase-on: FAILURE
                  current-parameters: true
        - multijob:
            name: functest
            projects:
                - name: 'tmp_fuel-test-{pod}-{loop}-{stream}'
                  current-parameters: true
        - multijob:
            name: yardstick
            projects:
                - name: 'tmp_fuel-test-{pod}-{loop}-{stream}'
                  current-parameters: true


- job-template:
    name: 'tmp_fuel-{dummy-phase}-{pod}-{loop}-{stream}'

    disabled: false

    concurrent: false

    wrappers:
        - build-name:
            name: '$BUILD_NUMBER: {installer} $CONTROLLER'

    parameters:
        - project-parameter:
            project: '{installer}'
        - '{pod}-defaults'
        - '{installer}-defaults'
        - string:
            name: CONTROLLER
            default: 'none'
        - string:
            name: FEATURE
            default: 'none'

    scm:
        - git-scm:
            credentials-id: '{ssh-credentials}'
            refspec: ''
            branch: '{branch}'

    builders:
        - shell: |
            #!/bin/bash
            echo "Hello World from OPNFV $INSTALLER_NAME"
            echo "Running $INSTALLER_NAME with controller $CONTROLLER"
