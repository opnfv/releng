---
- builder:
    name: xtesting-ci-docker-builder
    builders:
      - shell: |
          cd {dir}
          sudo docker build --pull -t {image} .
          sudo docker push {image}
          sudo docker system prune --all -f

- scm:
    name: xtesting-ci-docker-scm
    scm:
      - git:
          url: https://github.com/collivier/xtesting-docker.git
          git-config-name:
          git-config-email:

- trigger:
    name: xtesting-ci-docker-trigger
    triggers:
      - pollscm:
          cron: "H/30 * * * *"
      - timed: '@daily'

- parameter:
    name: xtesting-ci-docker-parameter
    parameters:
      - label:
          name: node
          default: 'lf-virtual1'

- job-template:
    name: xtesting-ci-docker-{stream}
    scm:
      - xtesting-ci-docker-scm
    parameters:
      - xtesting-ci-docker-parameter
    triggers:
      - xtesting-ci-docker-trigger
    builders:
      - xtesting-ci-docker-builder:
          image: '{image}'
          dir: '{dir}'

- project:
    name: xtesting-ci-docker
    stream:
      - jenkins-debian-lts-slim:
          dir: jenkins.debian
          image: opnfv/xtesting-jenkins:lts-slim
      - jenkins-debian-lts-alpine:
          dir: jenkins
          image: opnfv/xtesting-jenkins:lts-alpine
      - s3www-v0.5.3:
          dir: s3www
          image: opnfv/xtesting-s3www:v0.5.3
    jobs:
      - xtesting-ci-docker-{stream}

- view:
    name: xtesting-ci-docker
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: ^xtesting-ci-docker.*$
