---
- _functest-kubernetes-containers: &functest-kubernetes-containers
    name: 'functest-kubernetes-containers'
    repo: '{repo}'
    port: '{port}'
    container: '{container}'
    tag: '{tag}'

- _functest-kubernetes-params: &functest-kubernetes-params
    name: 'functest-kubernetes-params'
    tag:
      - latest:
          from:
          build_args:
          branch: master
          node: latest
          dependency: 3.20
      - v1.31:
          from:
          build_args:
          branch: stable/v1.31
          node: v1.31
          dependency: 3.20
      - v1.30:
          from:
          build_args:
          branch: stable/v1.30
          node: v1.30
          dependency: 3.20
      - v1.29:
          from:
          build_args:
          branch: stable/v1.29
          node: v1.29
          dependency: 3.16
      - v1.28:
          from:
          build_args:
          branch: stable/v1.28
          node: v1.28
          dependency: 3.16

- _functest-kubernetes-opnfv-functest-kubernetes-healthcheck-params: &functest-kubernetes-opnfv-functest-kubernetes-healthcheck-params
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-params'
    repo: 'opnfv'
    container: 'functest-kubernetes-healthcheck'
    port:
    tag:
      - latest:
          from:
          build_args:
          branch: master
          node: latest
          dependency: 3.20
      - v1.31:
          from:
          build_args:
          branch: stable/v1.31
          node: v1.31
          dependency: 3.20
      - v1.30:
          from:
          build_args:
          branch: stable/v1.30
          node: v1.30
          dependency: 3.20
      - v1.29:
          from:
          build_args:
          branch: stable/v1.29
          node: v1.29
          dependency: 3.16
      - v1.28:
          from:
          build_args:
          branch: stable/v1.28
          node: v1.28
          dependency: 3.16

- _functest-kubernetes-opnfv-functest-kubernetes-smoke-params: &functest-kubernetes-opnfv-functest-kubernetes-smoke-params
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-params'
    repo: 'opnfv'
    container: 'functest-kubernetes-smoke'
    port:
    tag:
      - latest:
          from:
          build_args:
          branch: master
          node: latest
          dependency: 3.20
      - v1.31:
          from:
          build_args:
          branch: stable/v1.31
          node: v1.31
          dependency: 3.20
      - v1.30:
          from:
          build_args:
          branch: stable/v1.30
          node: v1.30
          dependency: 3.20
      - v1.29:
          from:
          build_args:
          branch: stable/v1.29
          node: v1.29
          dependency: 3.16
      - v1.28:
          from:
          build_args:
          branch: stable/v1.28
          node: v1.28
          dependency: 3.16

- _functest-kubernetes-opnfv-functest-kubernetes-security-params: &functest-kubernetes-opnfv-functest-kubernetes-security-params
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-params'
    repo: 'opnfv'
    container: 'functest-kubernetes-security'
    port:
    tag:
      - latest:
          from:
          build_args:
          branch: master
          node: latest
          dependency: 3.20
      - v1.31:
          from:
          build_args:
          branch: stable/v1.31
          node: v1.31
          dependency: 3.20
      - v1.30:
          from:
          build_args:
          branch: stable/v1.30
          node: v1.30
          dependency: 3.20
      - v1.29:
          from:
          build_args:
          branch: stable/v1.29
          node: v1.29
          dependency: 3.16
      - v1.28:
          from:
          build_args:
          branch: stable/v1.28
          node: v1.28
          dependency: 3.16

- _functest-kubernetes-opnfv-functest-kubernetes-benchmarking-params: &functest-kubernetes-opnfv-functest-kubernetes-benchmarking-params
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-params'
    repo: 'opnfv'
    container: 'functest-kubernetes-benchmarking'
    port:
    tag:
      - latest:
          from:
          build_args:
          branch: master
          node: latest
          dependency: 3.20
      - v1.31:
          from:
          build_args:
          branch: stable/v1.31
          node: v1.31
          dependency: 3.20
      - v1.30:
          from:
          build_args:
          branch: stable/v1.30
          node: v1.30
          dependency: 3.20
      - v1.29:
          from:
          build_args:
          branch: stable/v1.29
          node: v1.29
          dependency: 3.16
      - v1.28:
          from:
          build_args:
          branch: stable/v1.28
          node: v1.28
          dependency: 3.16

- _functest-kubernetes-opnfv-functest-kubernetes-cnf-params: &functest-kubernetes-opnfv-functest-kubernetes-cnf-params
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-params'
    repo: 'opnfv'
    container: 'functest-kubernetes-cnf'
    port:
    tag:
      - latest:
          from:
          build_args:
          branch: master
          node: latest
          dependency: 3.20
      - v1.31:
          from:
          build_args:
          branch: stable/v1.31
          node: v1.31
          dependency: 3.20
      - v1.30:
          from:
          build_args:
          branch: stable/v1.30
          node: v1.30
          dependency: 3.20
      - v1.29:
          from:
          build_args:
          branch: stable/v1.29
          node: v1.29
          dependency: 3.16
      - v1.28:
          from:
          build_args:
          branch: stable/v1.28
          node: v1.28
          dependency: 3.16

- _functest-kubernetes-jobs: &functest-kubernetes-jobs
    name: 'functest-kubernetes-jobs'
    current-parameters: true

- parameter:
    name: functest-kubernetes-node
    parameters:
      - label:
          name: node
          default: '{node}'

- parameter:
    name: functest-kubernetes-build_tag
    parameters:
      - random-string:
          name: build_tag

- parameter:
    name: functest-kubernetes-DEPLOY_SCENARIO
    parameters:
      - string:
          name: DEPLOY_SCENARIO
          default: k8-nosdn-nofeature-noha

- _functest-kubernetes-run-containers: &functest-kubernetes-run-containers
    name: 'functest-kubernetes-run-containers'
    <<: *functest-kubernetes-containers
    privileged: '{privileged}'
    volumes: '{volumes}'
    env: '{env}'
    network: '{network}'
    uid: '{uid}'
    gid: '{gid}'
    published_ports: '{published_ports}'

- builder:
    name: functest-kubernetes-pull-containers
    builders:
      - shell: |
          set +x
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          docker pull $image

- builder:
    name: functest-kubernetes-run-containers
    builders:
      - shell: |
          set +x
          volumes=;
          if [ "{volumes}" != "None" ]; then
            for i in $(echo {volumes} | tr -d '[]' |sed "s/, / /g" ); \
              do volumes="-v $i $volumes"; done
          fi
          env=;
          if [ "{env}" != "None" ]; then
            for i in $(eval echo {env} | tr -d '[]' |sed "s/, / /g" ); \
              do env="-e $i $env"; done
          fi
          published_ports=;
          if [ "{published_ports}" != "None" ]; then
            for i in $(echo {published_ports} | tr -d '[]' |sed "s/, / /g" ); \
              do published_ports="-p $i $published_ports"; done
          fi
          [ ! -z "$WORKSPACE" ] && rm -rf $WORKSPACE/results || true
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          mkdir -p $WORKSPACE/results
          chown {uid}:{gid} $WORKSPACE/results
          docker run --rm \
            --privileged={privileged} \
            --network={network} \
            $volumes \
            $env \
            $published_ports \
            -e S3_ENDPOINT_URL=https://storage.googleapis.com \
            -e S3_DST_URL=s3://artifacts.opnfv.org/functest-kubernetes/$BUILD_TAG/$JOB_NAME-$BUILD_ID \
            -e HTTP_DST_URL=http://artifacts.opnfv.org/functest-kubernetes/$BUILD_TAG/$JOB_NAME-$BUILD_ID \
            -v /home/opnfv/functest-kubernetes/.boto:/etc/boto.cfg \
            -e TEST_DB_URL=http://testresults.opnfv.org/test/api/v1/results \
            -e TEST_DB_EXT_URL=http://testresults.opnfv.org/test/api/v1/results \
            -e NODE_NAME=$node \
            -e BUILD_TAG=$BUILD_TAG \
            -v $WORKSPACE/../$JOB_NAME/results:/var/lib/xtesting/results \
            $image run_tests -t {test} -p -r

- builder:
    name: functest-kubernetes-remove-images
    builders:
      - shell: |
          set +x
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          docker rmi $image || true

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-pull'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-pull-containers:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-pull'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-healthcheck-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-pull'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-rmi'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-remove-images:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-rmi'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-healthcheck-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-rmi'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-pull'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-pull-containers:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-pull'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-smoke-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-pull'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-rmi'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-remove-images:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-rmi'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-smoke-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-rmi'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-pull'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-pull-containers:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-pull'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-security-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-pull'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-rmi'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-remove-images:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-rmi'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-security-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-rmi'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-pull'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-pull-containers:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-pull'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-benchmarking-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-pull'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-rmi'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-remove-images:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-rmi'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-benchmarking-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-rmi'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-pull'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-pull-containers:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-pull'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-cnf-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-pull'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-rmi'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-remove-images:
          <<: *functest-kubernetes-containers

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-rmi'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-cnf-params
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-rmi'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-{test}-run'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    builders:
      - functest-kubernetes-run-containers:
          <<: *functest-kubernetes-run-containers
          test: '{test}'

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-healthcheck-params
    volumes:
      - /home/opnfv/functest-kubernetes/config.{tag}:/root/.kube/config
      - /home/opnfv/functest-kubernetes/config.{tag}:/home/xtesting/.kube/config
    env:
      - DEPLOY_SCENARIO=$DEPLOY_SCENARIO
    published_ports:
    container: 'functest-kubernetes-healthcheck'
    test:
      - k8s_quick
      - k8s_smoke
    privileged: 'false'
    network: bridge
    uid: 1000
    gid: 1000
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-{test}-run'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-{test}-run'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    builders:
      - functest-kubernetes-run-containers:
          <<: *functest-kubernetes-run-containers
          test: '{test}'

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-smoke-params
    volumes:
      - /home/opnfv/functest-kubernetes/config.{tag}:/root/.kube/config
      - /home/opnfv/functest-kubernetes/config.{tag}:/home/xtesting/.kube/config
    env:
      - DEPLOY_SCENARIO=$DEPLOY_SCENARIO
    published_ports:
    container: 'functest-kubernetes-smoke'
    test:
      - xrally_kubernetes
      - k8s_conformance
      - k8s_conformance_serial
      - sig_api_machinery
      - sig_api_machinery_serial
      - sig_apps
      - sig_apps_serial
      - sig_auth
      - sig_cluster_lifecycle
      - sig_instrumentation
      - sig_network
      - sig_node
      - sig_scheduling_serial
      - sig_storage
      - sig_storage_serial
    privileged: 'false'
    network: bridge
    uid: 1000
    gid: 1000
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-{test}-run'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-{test}-run'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    builders:
      - functest-kubernetes-run-containers:
          <<: *functest-kubernetes-run-containers
          test: '{test}'

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-security-params
    volumes:
      - /home/opnfv/functest-kubernetes/config.{tag}:/root/.kube/config
      - /home/opnfv/functest-kubernetes/config.{tag}:/home/xtesting/.kube/config
    env:
      - DEPLOY_SCENARIO=$DEPLOY_SCENARIO
    published_ports:
    container: 'functest-kubernetes-security'
    test:
      - kube_hunter
      - kube_bench_master
      - kube_bench_node
    privileged: 'false'
    network: bridge
    uid: 1000
    gid: 1000
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-{test}-run'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-{test}-run'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    builders:
      - functest-kubernetes-run-containers:
          <<: *functest-kubernetes-run-containers
          test: '{test}'

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-benchmarking-params
    volumes:
      - /home/opnfv/functest-kubernetes/config.{tag}:/root/.kube/config
      - /home/opnfv/functest-kubernetes/config.{tag}:/home/xtesting/.kube/config
    env:
      - DEPLOY_SCENARIO=$DEPLOY_SCENARIO
    published_ports:
    container: 'functest-kubernetes-benchmarking'
    test:
      - xrally_kubernetes_full
      - netperf
    privileged: 'false'
    network: bridge
    uid: 1000
    gid: 1000
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-{test}-run'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-{test}-run'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    builders:
      - functest-kubernetes-run-containers:
          <<: *functest-kubernetes-run-containers
          test: '{test}'

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-cnf-params
    volumes:
      - /home/opnfv/functest-kubernetes/config.{tag}:/root/.kube/config
      - /home/opnfv/functest-kubernetes/config.{tag}:/home/xtesting/.kube/config
    env:
      - DEPLOY_SCENARIO=$DEPLOY_SCENARIO
    published_ports:
    container: 'functest-kubernetes-cnf'
    test:
      - k8s_vims
      - helm_vims
      - cnf_testsuite
    privileged: 'false'
    network: bridge
    uid: 1000
    gid: 1000
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-{test}-run'

- builder:
    name: functest-kubernetes-zip
    builders:
      - shell: |
          set +x
          volumes=;
          if [ "{volumes}" != "None" ]; then
            for i in $(echo {volumes} | tr -d '[]' |sed "s/, / /g" ); \
              do volumes="-v $i $volumes"; done
          fi
          env=;
          if [ "{env}" != "None" ]; then
            for i in $(eval echo {env} | tr -d '[]' |sed "s/, / /g" ); \
              do env="-e $i $env"; done
          fi
          published_ports=;
          if [ "{published_ports}" != "None" ]; then
            for i in $(echo {published_ports} | tr -d '[]' |sed "s/, / /g" ); \
              do published_ports="-p $i $published_ports"; done
          fi
          [ ! -z "$WORKSPACE" ] && rm -rf $WORKSPACE/results || true
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          mkdir -p $WORKSPACE/results
          chown {uid}:{gid} $WORKSPACE/results
          docker run --rm \
            --privileged={privileged} \
            --network={network} \
            $volumes \
            $env \
            $published_ports \
            -e S3_ENDPOINT_URL=https://storage.googleapis.com \
            -e S3_DST_URL=s3://artifacts.opnfv.org/functest-kubernetes \
            -e HTTP_DST_URL=http://artifacts.opnfv.org/functest-kubernetes \
            -v /home/opnfv/functest-kubernetes/.boto:/etc/boto.cfg \
            -e TEST_DB_URL=http://testresults.opnfv.org/test/api/v1/results \
            -e TEST_DB_EXT_URL=http://testresults.opnfv.org/test/api/v1/results \
            -e NODE_NAME=$node \
            -e BUILD_TAG=$BUILD_TAG \
            -v $WORKSPACE/../$JOB_NAME/results:/var/lib/xtesting/results \
            $image zip_campaign

- job-template:
    name: 'functest-kubernetes-{tag}-zip'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    builders:
      - functest-kubernetes-zip:
          <<: *functest-kubernetes-run-containers

- project:
    name: 'functest-kubernetes-zip'
    <<: *functest-kubernetes-opnfv-functest-kubernetes-healthcheck-params
    volumes:
      - /home/opnfv/functest-kubernetes/config.{tag}:/root/.kube/config
      - /home/opnfv/functest-kubernetes/config.{tag}:/home/xtesting/.kube/config
    env:
      - DEPLOY_SCENARIO=$DEPLOY_SCENARIO
    published_ports:
    container: 'functest-kubernetes-healthcheck'
    privileged: 'false'
    network: bridge
    uid: 1000
    gid: 1000
    jobs:
      - 'functest-kubernetes-{tag}-zip'

- job-template:
    name: 'functest-kubernetes-{tag}-daily'
    project-type: multijob
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    # PyYAML and yamllint differ here
    # see https://github.com/yaml/pyyaml/issues/234
    # yamllint disable rule:indentation
    properties:
      - build-blocker:
          blocking-jobs:
          - ^functest-kubernetes-(pi-)*.*-(daily|docker|review)$
    # yamllint enable rule:indentation
    builders:
      - multijob:
          name: remove former images
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-rmi'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: pull containers
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-pull'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-pull'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-pull'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-pull'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-pull'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-healthcheck:{tag}
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-k8s_quick-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-k8s_smoke-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-smoke:{tag}
          execution-type: SEQUENTIALLY
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-xrally_kubernetes-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-k8s_conformance-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-k8s_conformance_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_api_machinery-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_api_machinery_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_apps-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_apps_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_auth-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_cluster_lifecycle-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_instrumentation-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_network-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_node-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_scheduling_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_storage-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_storage_serial-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-security:{tag}
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-kube_hunter-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-kube_bench_master-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-kube_bench_node-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-benchmarking:{tag}
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-xrally_kubernetes_full-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-netperf-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-cnf:{tag}
          execution-type: SEQUENTIALLY
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-k8s_vims-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-helm_vims-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-cnf_testsuite-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: dump all campaign data
          projects:
            - name: 'functest-kubernetes-{tag}-zip'
              <<: *functest-kubernetes-jobs
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-daily'
    <<: *functest-kubernetes-params
    jobs:
      - 'functest-kubernetes-{tag}-daily'

- view:
    name: functest-kubernetes
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: ^functest-kubernetes-[a-z0-9.]+-daily$

- _functest-kubernetes-build-containers: &functest-kubernetes-build-containers
    name: 'functest-kubernetes-build-containers'
    <<: *functest-kubernetes-containers
    ref_arg: '{ref_arg}'
    path: '{path}'
    build_args: '{build_args}'
    from: '{from}'

- builder:
    name: functest-kubernetes-build-containers
    builders:
      - shell: |
          set +x
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          build_args=""
          if [ "{build_args}" != "None" ]; then
            for i in $(echo {build_args} | tr -d '[]' |sed "s/, / /g" ); \
              do build_args="--build-arg $i $build_args"; done
          fi
          if [ "{ref_arg}" != "None" ]; then
            build_args="$build_args --build-arg {ref_arg}={ref}"
          fi
          cd {path}
          if [ "{from}" != "None" ]; then
              sed -i {from} Dockerfile
          fi
          docker build $build_args \
            --pull=false --no-cache --force-rm=true \
            -t $image .

- scm:
    name: functest-kubernetes-scm
    scm:
      - git:
          url: 'https://gerrit.opnfv.org/gerrit/functest-kubernetes'
          refspec: '+refs/heads/*:refs/remotes/origin/* +refs/changes/*:refs/changes/*'
          branches:
            - '{ref}'

- _functest-kubernetes-dep: &functest-kubernetes-dep
    name: 'functest-kubernetes-containers'
    repo: '{repo}'
    container: '{container}'
    port: '{port}'
    tag: '{dependency}'

- job-template:
    name: 'functest-kubernetes-{tag}-dep-pull'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-pull-containers:
          <<: *functest-kubernetes-dep

- _functest-kubernetes-dep-params: &functest-kubernetes-dep-params
    name: 'functest-kubernetes-dep-params'
    repo: '_'
    container: 'alpine'
    port:
    tag:
      - latest:
          dependency: 3.20
      - v1.31:
          dependency: 3.20
      - v1.30:
          dependency: 3.20
      - v1.29:
          dependency: 3.16
      - v1.28:
          dependency: 3.16

- project:
    name: 'functest-kubernetes-dep-pull'
    <<: *functest-kubernetes-dep-params
    jobs:
      - 'functest-kubernetes-{tag}-dep-pull'

- job-template:
    name: 'functest-kubernetes-{tag}-dep-rmi'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-remove-images:
          <<: *functest-kubernetes-dep

- project:
    name: 'functest-kubernetes-dep-rmi'
    <<: *functest-kubernetes-dep-params
    jobs:
      - 'functest-kubernetes-{tag}-dep-rmi'

- builder:
    name: functest-kubernetes-tox
    builders:
      - shell: |
          set +x
          apt-get -o DPkg::Lock::Timeout=300 update && \
          DEBIAN_FRONTEND=noninteractive apt-get \
            -o DPkg::Lock::Timeout=300 dist-upgrade -y
          DEBIAN_FRONTEND=noninteractive \
          apt-get -o DPkg::Lock::Timeout=300 install software-properties-common gpg -y
          add-apt-repository -y ppa:deadsnakes/ppa
          apt-get -o DPkg::Lock::Timeout=300 update && \
          DEBIAN_FRONTEND=noninteractive apt-get \
            -o DPkg::Lock::Timeout=300 install \
            libxml2-dev libxslt-dev libffi-dev libjpeg-dev \
            python3.12 python3.12-dev python3.12-distutils \
            python3.11 python3.11-dev python3.11-distutils \
            python3.10 python3.10-dev python3.10-distutils \
            python3.9 python3.9-dev python3.9-distutils \
            python3.8 python3.8-dev python3.8-distutils \
            python3-pip enchant-2 -y
          pip3 install tox

          tox

- job-template:
    name: 'functest-kubernetes-{tag}-tox'
    scm:
      - functest-kubernetes-scm:
          ref: $GERRIT_REFSPEC
    triggers:
      - functest-kubernetes-patchset-created:
          branch: '{branch}'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-tox:

- project:
    name: functest-kubernetes-tox
    <<: *functest-kubernetes-params
    jobs:
      - 'functest-kubernetes-{tag}-tox'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-gate'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: $GERRIT_REFSPEC
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: $GERRIT_REFSPEC
          build_args: '{build_args}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-core-gate
    <<: *functest-kubernetes-params
    repo: opnfv
    port:
    container: functest-kubernetes-core
    ref_arg: BRANCH
    path: docker/core
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-gate'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-gate'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: $GERRIT_REFSPEC
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: $GERRIT_REFSPEC
          build_args: '{build_args}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-healthcheck-gate
    <<: *functest-kubernetes-params
    repo: opnfv
    port:
    container: functest-kubernetes-healthcheck
    ref_arg:
    path: docker/healthcheck
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-gate'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-gate'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: $GERRIT_REFSPEC
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: $GERRIT_REFSPEC
          build_args: '{build_args}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-cnf-gate
    <<: *functest-kubernetes-params
    repo: opnfv
    port:
    container: functest-kubernetes-cnf
    ref_arg: BRANCH
    path: docker/cnf
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-gate'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-gate'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: $GERRIT_REFSPEC
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: $GERRIT_REFSPEC
          build_args: '{build_args}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-security-gate
    <<: *functest-kubernetes-params
    repo: opnfv
    port:
    container: functest-kubernetes-security
    ref_arg: BRANCH
    path: docker/security
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-gate'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-gate'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: $GERRIT_REFSPEC
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: $GERRIT_REFSPEC
          build_args: '{build_args}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-smoke-gate
    <<: *functest-kubernetes-params
    repo: opnfv
    port:
    container: functest-kubernetes-smoke
    ref_arg:
    path: docker/smoke
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-gate'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-gate'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: $GERRIT_REFSPEC
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: $GERRIT_REFSPEC
          build_args: '{build_args}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-benchmarking-gate
    <<: *functest-kubernetes-params
    repo: opnfv
    port:
    container: functest-kubernetes-benchmarking
    ref_arg:
    path: docker/benchmarking
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-gate'

- trigger:
    name: functest-kubernetes-patchset-created
    triggers:
      - gerrit:
          trigger-on:
            - patchset-created-event
            - comment-added-contains-event:
                comment-contains-value: 'recheck'
            - comment-added-contains-event:
                comment-contains-value: 'reverify'
          projects:
            - project-compare-type: 'ANT'
              project-pattern: 'functest-kubernetes'
              branches:
                - branch-compare-type: 'ANT'
                  branch-pattern: '**/{branch}'

- job-template:
    name: 'functest-kubernetes-{tag}-review'
    project-type: multijob
    triggers:
      - functest-kubernetes-patchset-created:
          branch: '{branch}'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
      - functest-kubernetes-build_tag:
          build_tag: ''
      - functest-kubernetes-DEPLOY_SCENARIO:
          DEPLOY_SCENARIO: k8-nosdn-nofeature-noha
    # PyYAML and yamllint differ here
    # see https://github.com/yaml/pyyaml/issues/234
    # yamllint disable rule:indentation
    properties:
      - build-blocker:
          blocking-jobs:
          - ^functest-kubernetes-(pi-)*.*-(daily|docker|review)$
    # yamllint enable rule:indentation
    builders:
      - multijob:
          name: remove former images
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-rmi'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-rmi'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: remove dependency
          projects:
            - name: 'functest-kubernetes-{tag}-dep-rmi'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: pull dependency
          projects:
            - name: 'functest-kubernetes-{tag}-dep-pull'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build opnfv/functest-kubernetes-core
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-gate'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build containers
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-gate'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-gate'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-gate'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build opnfv/functest-kubernetes-smoke
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-gate'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build opnfv/functest-kubernetes-benchmarking
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-gate'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-healthcheck:{tag}
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-k8s_quick-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-k8s_smoke-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-smoke:{tag}
          execution-type: SEQUENTIALLY
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-xrally_kubernetes-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-k8s_conformance-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-k8s_conformance_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_api_machinery-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_api_machinery_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_apps-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_apps_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_auth-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_cluster_lifecycle-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_instrumentation-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_network-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_node-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_scheduling_serial-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_storage-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sig_storage_serial-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-security:{tag}
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-kube_hunter-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-kube_bench_master-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-kube_bench_node-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-benchmarking:{tag}
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-xrally_kubernetes_full-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-netperf-run'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: opnfv/functest-kubernetes-cnf:{tag}
          execution-type: SEQUENTIALLY
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-k8s_vims-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-helm_vims-run'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-cnf_testsuite-run'
              <<: *functest-kubernetes-jobs
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-review'
    <<: *functest-kubernetes-params
    jobs:
      - 'functest-kubernetes-{tag}-review'

- view:
    name: functest-kubernetes-review
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: ^functest-kubernetes-[a-z0-9.]+-review$

- view:
    name: functest-kubernetes-tox
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: ^functest-kubernetes-[a-z0-9.]+-tox$

- builder:
    name: functest-kubernetes-push-containers
    builders:
      - shell: |
          set +x
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          docker push $image

- trigger:
    name: functest-kubernetes-commit
    triggers:
      - pollscm:
          cron: "*/30 * * * *"

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-build'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: '{branch}'
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'
          build_args: '{build_args}'
      - functest-kubernetes-push-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-core-build
    <<: *functest-kubernetes-params
    repo: opnfv
    container: functest-kubernetes-core
    port:
    ref_arg: BRANCH
    path: docker/core
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-build'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-build'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: '{branch}'
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'
          build_args: '{build_args}'
      - functest-kubernetes-push-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-healthcheck-build
    <<: *functest-kubernetes-params
    repo: opnfv
    container: functest-kubernetes-healthcheck
    port:
    ref_arg:
    path: docker/healthcheck
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-build'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-build'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: '{branch}'
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'
          build_args: '{build_args}'
      - functest-kubernetes-push-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-cnf-build
    <<: *functest-kubernetes-params
    repo: opnfv
    container: functest-kubernetes-cnf
    port:
    ref_arg: BRANCH
    path: docker/cnf
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-build'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-build'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: '{branch}'
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'
          build_args: '{build_args}'
      - functest-kubernetes-push-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-security-build
    <<: *functest-kubernetes-params
    repo: opnfv
    container: functest-kubernetes-security
    port:
    ref_arg: BRANCH
    path: docker/security
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-build'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-build'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: '{branch}'
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'
          build_args: '{build_args}'
      - functest-kubernetes-push-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-smoke-build
    <<: *functest-kubernetes-params
    repo: opnfv
    container: functest-kubernetes-smoke
    port:
    ref_arg:
    path: docker/smoke
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-build'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-build'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    scm:
      - functest-kubernetes-scm:
          ref: '{branch}'
    builders:
      - functest-kubernetes-build-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'
          build_args: '{build_args}'
      - functest-kubernetes-push-containers:
          <<: *functest-kubernetes-build-containers
          ref: '{branch}'

- project:
    name: functest-kubernetes-opnfv-functest-kubernetes-benchmarking-build
    <<: *functest-kubernetes-params
    repo: opnfv
    container: functest-kubernetes-benchmarking
    port:
    ref_arg:
    path: docker/benchmarking
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-build'

- job-template:
    name: 'functest-kubernetes-{tag}-docker'
    project-type: multijob
    triggers:
      - functest-kubernetes-commit
    scm:
      - functest-kubernetes-scm:
          ref: '{branch}'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    # PyYAML and yamllint differ here
    # see https://github.com/yaml/pyyaml/issues/234
    # yamllint disable rule:indentation
    properties:
      - build-blocker:
          blocking-jobs:
          - ^functest-kubernetes-(pi-)*.*-(daily|docker|review)$
    # yamllint enable rule:indentation
    builders:
      - multijob:
          name: remove dependency
          projects:
            - name: 'functest-kubernetes-{tag}-dep-rmi'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: pull dependency
          projects:
            - name: 'functest-kubernetes-{tag}-dep-pull'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build opnfv/functest-kubernetes-core
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-build'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build containers
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-build'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-build'
              <<: *functest-kubernetes-jobs
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-build'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build opnfv/functest-kubernetes-smoke
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-build'
              <<: *functest-kubernetes-jobs
      - multijob:
          name: build opnfv/functest-kubernetes-benchmarking
          projects:
            - name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-build'
              <<: *functest-kubernetes-jobs
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-docker'
    <<: *functest-kubernetes-params
    jobs:
      - 'functest-kubernetes-{tag}-docker'

- builder:
    name: functest-kubernetes-trivy
    builders:
      - shell: |
          apt-get -o DPkg::Lock::Timeout=300 update && \
          DEBIAN_FRONTEND=noninteractive apt-get \
            -o DPkg::Lock::Timeout=300 install curl -y

          curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b .
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          ./trivy image --exit-code 1 $image

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-trivy'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-trivy:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-trivy'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-core'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-trivy'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-trivy'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-trivy:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-trivy'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-healthcheck'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-trivy'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-trivy'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-trivy:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-trivy'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-cnf'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-trivy'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-trivy'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-trivy:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-trivy'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-security'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-trivy'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-trivy'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-trivy:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-trivy'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-smoke'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-trivy'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-trivy'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-trivy:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-trivy'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-benchmarking'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-trivy'

- builder:
    name: functest-kubernetes-grype
    builders:
      - shell: |
          apt-get -o DPkg::Lock::Timeout=300 update && \
          DEBIAN_FRONTEND=noninteractive apt-get \
            -o DPkg::Lock::Timeout=300 install curl -y

          curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b .
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          ./grype -q $image

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-grype'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-grype:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-grype'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-core'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-grype'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-grype'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-grype:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-grype'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-healthcheck'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-grype'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-grype'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-grype:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-grype'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-cnf'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-grype'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-grype'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-grype:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-grype'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-security'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-grype'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-grype'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-grype:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-grype'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-smoke'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-grype'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-grype'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-grype:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-grype'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-benchmarking'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-grype'

- builder:
    name: functest-kubernetes-sbom
    builders:
      - shell: |
          apt-get -o DPkg::Lock::Timeout=300 update && \
          DEBIAN_FRONTEND=noninteractive apt-get \
            -o DPkg::Lock::Timeout=300 install curl -y

          mkdir -p ~/.docker
          curl -sSfL https://raw.githubusercontent.com/docker/sbom-cli-plugin/main/install.sh | sh -s --
          if [ "{repo}" = "_" ]; then
            image={container}:{tag}
          elif [ "{port}" = "None" ]; then
            image={repo}/{container}:{tag}
          else
            image={repo}:{port}/{container}:{tag}
          fi
          docker sbom $image

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-sbom'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-sbom:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-core-sbom'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-core'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-core-{tag}-sbom'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-sbom'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-sbom:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-sbom'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-healthcheck'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-healthcheck-{tag}-sbom'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-sbom'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-sbom:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-cnf-sbom'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-cnf'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-cnf-{tag}-sbom'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-sbom'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-sbom:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-security-sbom'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-security'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-security-{tag}-sbom'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sbom'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-sbom:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-smoke-sbom'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-smoke'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-smoke-{tag}-sbom'

- job-template:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-sbom'
    triggers:
      - timed: '@weekly'
    parameters:
      - functest-kubernetes-node:
          node: '{node}'
    builders:
      - functest-kubernetes-sbom:
          <<: *functest-kubernetes-containers
    publishers:
      - email-ext:
          failure: false
          first-failure: true
          fixed: true
          recipients: cedric.ollivier@orange.com

- project:
    name: 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-sbom'
    <<: *functest-kubernetes-params
    repo: 'opnfv'
    container: 'functest-kubernetes-benchmarking'
    port:
    jobs:
      - 'functest-kubernetes-opnfv-functest-kubernetes-benchmarking-{tag}-sbom'

- view:
    name: functest-kubernetes-docker
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: ^functest-kubernetes-[a-z0-9.]+-docker$

- view:
    name: functest-kubernetes-trivy
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: (?!functest-kubernetes-pi)(?!functest-kubernetes-ng)^functest-kubernetes-[a-z-0-9.]+-trivy$

- view:
    name: functest-kubernetes-grype
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: (?!functest-kubernetes-pi)(?!functest-kubernetes-ng)^functest-kubernetes-[a-z-0-9.]+-grype$

- view:
    name: functest-kubernetes-sbom
    view-type: list
    columns:
      - status
      - weather
      - job
      - last-success
      - last-failure
      - last-duration
    regex: (?!functest-kubernetes-pi)(?!functest-kubernetes-ng)^functest-kubernetes-[a-z-0-9.]+-sbom$
